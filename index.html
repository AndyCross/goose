<!DOCTYPE html>
    <head>
        <!-- Spotify CSS files -->
        <link rel="stylesheet" type="text/css" href="sp://resources/css/eve.css">
        <link rel="stylesheet" type="text/css" href="sp://resources/css/api.css">
        <link rel="stylesheet" type="text/css" href="sp://resources/css/player.css">
        <link rel="stylesheet" type="text/css" href="sp://resources/css/list.css">

        <!-- Project CSS files -->
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <link rel="stylesheet" type="text/css" href="css/github.css">

        <script src="/js/jquery.min.js"></script>
        <script src="/js/jquery.signalR.min.js"></script>
        <script src="/js/jTmpl.js"></script>
        <script src="/js/jargs.js"></script>
        <script src="/js/flap.js"></script>

    </head>
    <body>
        <div id="wrapper">
            <div id="index" class="section">
                <img src="/goose300x300.png" class="right" />
                <h2>Goose</h2>
                <h3>V0.0.10</h3>

                <div id="data"></div>

                <p>Geo-synchronise playing.</p>
                <p>The idea on this tab is that we'll have a simple instruction on how the app works and maybe a tutorial video or something.
                    The user would then choose whether they're going to be a DJ (lead) or listen in (tail). </p>
            </div>

            <div id="leadgoose" class="section" style="display:none;">
                    <h3>Lead Goose</h3>
                    <p>Hey Goose; you're the lead goose - you choose the music that your flock listen to.</p>
                    <div class="html-snippet" data-container="html">
                        <input type="text" id="searchTerm" />
                        <button class="sp-button sp-primary" id="doSearch" onclick="javascript:search()">Search</button>
                    </div>

                    <script type="text/html" id="prepareToShare_tmpl">
                      <div id="<%=uri%>">
                        <div>
                          <a class="artistLink"><img class="artistimage" src="<%=image%>"/></a>
                        </div>
                        <div class="grid_6 omega contents">
                          <p><b><%=name%></b></p>
                          <button class="" onclick="federate('<%=uri%>');">honk honk</button>
                        </div>
                      </div>
                    </script>

                    <div id="prepareToShare"></div>
                <div id="playlistDiv"></div>
            </div>

            <div id="tailgoose" class="section" style="display:none;">
                <h3>Tail Goose</h3>
                <p>Hey Goose; you're the tail goose - you listen to music that the Lead Goose is playing</p>

                <script type="text/html" id="taildetails_tmpl">
                  <div id="<%=uri%>">
                    <div>
                      <a class="artistLink"><img src="<%=image%>"/></a>
                    </div>
                    <div class="grid_6 omega contents">
                      <p><b><%=name%></b></p>
                    </div>
                  </div>
                </script>

                <div id="taildetails"></div>
            </div>

            <div id="about" class="section" style="display:none;">
                <img src="/goose128x128.png" class="right" />
                <h2>About Goose</h2>
                <p>Goose is about sharing tracks with your friends (special ones we hope) in real time. Get them to plug in a share code, then play your music. They'll hear what you're hearing, when you're hearing it. </p>
                <p>Developed by a Goose and her pet Lion.</p>
            </div>

            <div id="offline" class="section" style="display:none;">
                <h2>You have gone offline</h2>
            </div>
        </div>

        <script>
            var sp = getSpotifyApi();
            var models = sp.require('$api/models');
            var views = sp.require('$api/views');
            var connection = null;

            window.onload = function() {
                
                var sp = getSpotifyApi();
                var models = sp.require('$api/models');
            };

            $(document).ready(function() {
                $("#searchTerm").keyup(function(event){
                    if(event.keyCode == 13){
                        $("#doSearch").click();
                        $("#searchTerm").blur();
                    }
                });

                connection = $.connection('http://gooser.azurewebsites.net/goose', "group=123");

                connection.start().done(function() {

                    $("#data").html("connected");
                    connection.received(function(data) {
                        console.log(data);
                        $("#data").html(data);

                        var p = player.play(data);

                        $('#taildetails').empty();
                        $('#taildetails').html("<div class='loading'><div class='throbber'><div></div></div></div>")

                        var t1 = models.Track.fromURI(data, function(track) {
                                    var templated = tmpl("taildetails_tmpl", track);
                                    $("#taildetails").html(templated);
                                });                         

                        var link = new models.Link(trackUri);
                        $(".artistLink").attr("href", link.uri);
                    });
                }
                );

            });

            
        </script>
    </body>
</html>